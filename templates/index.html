{% extends 'base.html' %}
{% load static %}

{% block title %}Zelcry - Smart Crypto Investing for Everyone{% endblock %}

{% block extra_css %}
<style>
.live-ticker {
  background: var(--bg-secondary);
  padding: calc(var(--spacing-unit) * 1.5);
  border-radius: var(--radius-md);
  margin-bottom: calc(var(--spacing-unit) * 3);
  overflow: hidden;
}

.ticker-content {
  display: flex;
  gap: calc(var(--spacing-unit) * 3);
  animation: scroll 30s linear infinite;
}

@keyframes scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

.ticker-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-unit);
  white-space: nowrap;
}

.ticker-name {
  font-weight: 600;
  color: var(--text-primary);
}

.ticker-price {
  color: var(--text-secondary);
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: calc(var(--spacing-unit) * 2);
  margin: calc(var(--spacing-unit) * 4) 0;
}

.feature {
  background: var(--bg-card);
  padding: calc(var(--spacing-unit) * 3);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-light);
  transition: all 0.3s ease;
}

.feature:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
  border-color: var(--primary);
}

.feature-icon {
  font-size: 3rem;
  margin-bottom: calc(var(--spacing-unit) * 2);
  display: block;
}

.feature-title {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: var(--spacing-unit);
  color: var(--text-primary);
}

.feature-desc {
  color: var(--text-secondary);
  line-height: 1.6;
}

.try-demo {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: calc(var(--spacing-unit) * 3);
  margin: calc(var(--spacing-unit) * 4) 0;
  border: 2px solid var(--border-light);
}

.crypto-search {
  display: flex;
  gap: var(--spacing-unit);
  margin-bottom: calc(var(--spacing-unit) * 2);
}

.live-prices {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: calc(var(--spacing-unit) * 2);
}

.price-card {
  background: var(--bg-secondary);
  padding: calc(var(--spacing-unit) * 2);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-light);
  transition: all 0.2s ease;
}

.price-card:hover {
  border-color: var(--primary);
  transform: scale(1.02);
}

.price-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-unit);
}

.coin-name {
  font-weight: 700;
  color: var(--text-primary);
}

.coin-symbol {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  text-transform: uppercase;
}

.coin-price {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: calc(var(--spacing-unit) * 0.5);
}

.stats-preview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: calc(var(--spacing-unit) * 2);
  margin: calc(var(--spacing-unit) * 4) 0;
}

.stat-preview {
  text-align: center;
  padding: calc(var(--spacing-unit) * 2);
}

.stat-number {
  font-size: 2.5rem;
  font-weight: 900;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-text {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-top: var(--spacing-unit);
}

.cta-section {
  text-align: center;
  padding: calc(var(--spacing-unit) * 6) calc(var(--spacing-unit) * 2);
  background: linear-gradient(135deg, rgba(0, 102, 255, 0.1), rgba(0, 200, 83, 0.1));
  border-radius: var(--radius-xl);
  margin: calc(var(--spacing-unit) * 4) 0;
}

.cta-title {
  font-size: 2rem;
  font-weight: 800;
  margin-bottom: calc(var(--spacing-unit) * 2);
}

.cta-buttons {
  display: flex;
  gap: calc(var(--spacing-unit) * 2);
  justify-content: center;
  flex-wrap: wrap;
}

.loading-skeleton {
  background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-hover) 50%, var(--bg-secondary) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s ease-in-out infinite;
  border-radius: var(--radius-md);
  height: 100px;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="hero-section">
        <h1 class="hero-title">Invest in Crypto, Sustainably</h1>
        <p class="hero-subtitle">
            Track your portfolio, discover eco-friendly cryptocurrencies, and get AI-powered insights.
            Make smarter investment decisions with Zelcry.
        </p>

        {% if not user.is_authenticated %}
        <div class="hero-cta">
            <a href="{% url 'signup' %}" class="btn btn-primary btn-lg">Start Free Trial</a>
            <a href="#demo" class="btn btn-secondary btn-lg">Try Demo</a>
        </div>
        {% else %}
        <div class="hero-cta">
            <a href="{% url 'dashboard' %}" class="btn btn-primary btn-lg">Go to Dashboard</a>
        </div>
        {% endif %}
    </div>

    <div class="live-ticker">
        <div class="ticker-content" id="live-ticker">
            <div class="loading">Loading market data...</div>
        </div>
    </div>

    <div class="stats-preview">
        <div class="stat-preview">
            <div class="stat-number">100+</div>
            <div class="stat-text">Cryptocurrencies Tracked</div>
        </div>
        <div class="stat-preview">
            <div class="stat-number">$2T+</div>
            <div class="stat-text">Market Cap Coverage</div>
        </div>
        <div class="stat-preview">
            <div class="stat-number">50+</div>
            <div class="stat-text">Sustainability Scores</div>
        </div>
        <div class="stat-preview">
            <div class="stat-number">24/7</div>
            <div class="stat-text">Real-time Updates</div>
        </div>
    </div>

    <div id="demo" class="try-demo">
        <h2>Live Cryptocurrency Prices</h2>
        <p style="color: var(--text-secondary); margin-bottom: calc(var(--spacing-unit) * 3);">
            See real-time prices and trends. No signup required!
        </p>

        <div class="crypto-search">
            <input
                type="text"
                id="crypto-search"
                class="input"
                placeholder="Search cryptocurrencies..."
            >
        </div>

        <div class="live-prices" id="live-prices">
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
        </div>
    </div>

    <h2 style="text-align: center; margin: calc(var(--spacing-unit) * 6) 0 calc(var(--spacing-unit) * 3);">
        Why Choose Zelcry?
    </h2>

    <div class="features-grid">
        <div class="feature">
            <span class="feature-icon">ðŸ“Š</span>
            <h3 class="feature-title">Smart Portfolio Tracking</h3>
            <p class="feature-desc">
                Monitor your investments with real-time pricing, profit/loss calculations,
                and performance analytics. See your entire crypto portfolio at a glance.
            </p>
        </div>

        <div class="feature">
            <span class="feature-icon">ðŸŒ±</span>
            <h3 class="feature-title">Sustainability Scores</h3>
            <p class="feature-desc">
                Every cryptocurrency rated on energy efficiency, governance, and utility.
                Invest in projects that align with your values.
            </p>
        </div>

        <div class="feature">
            <span class="feature-icon">ðŸ¤–</span>
            <h3 class="feature-title">AI-Powered Advisor</h3>
            <p class="feature-desc">
                Get personalized recommendations based on your risk tolerance and goals.
                Ask questions and receive instant, intelligent insights.
            </p>
        </div>

        <div class="feature">
            <span class="feature-icon">ðŸ“ˆ</span>
            <h3 class="feature-title">Advanced Analytics</h3>
            <p class="feature-desc">
                Interactive charts, diversification metrics, and ROI tracking.
                Make data-driven decisions with professional-grade tools.
            </p>
        </div>

        <div class="feature">
            <span class="feature-icon">ðŸ””</span>
            <h3 class="feature-title">Price Alerts</h3>
            <p class="feature-desc">
                Set custom alerts for your favorite cryptocurrencies.
                Never miss important price movements or opportunities.
            </p>
        </div>

        <div class="feature">
            <span class="feature-icon">ðŸŽ“</span>
            <h3 class="feature-title">Learn as You Go</h3>
            <p class="feature-desc">
                Earn XP points as you explore and learn.
                Level up your crypto knowledge with our gamified experience.
            </p>
        </div>
    </div>

    {% if not user.is_authenticated %}
    <div class="cta-section">
        <h2 class="cta-title">Ready to Start Your Crypto Journey?</h2>
        <p style="color: var(--text-secondary); margin-bottom: calc(var(--spacing-unit) * 3); max-width: 600px; margin-left: auto; margin-right: auto;">
            Join thousands of investors making smarter, more sustainable crypto investments.
        </p>
        <div class="cta-buttons">
            <a href="{% url 'signup' %}" class="btn btn-primary btn-lg">Create Free Account</a>
            <a href="{% url 'login' %}" class="btn btn-secondary btn-lg">Sign In</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
let allCoins = [];

async function fetchLivePrices() {
  try {
    const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h');
    const data = await response.json();
    allCoins = data;
    displayPrices(data);
    updateTicker(data.slice(0, 10));
  } catch (error) {
    console.error('Error fetching prices:', error);
    document.getElementById('live-prices').innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">Unable to load prices. Please try again later.</p>';
  }
}

function displayPrices(coins) {
  const container = document.getElementById('live-prices');
  container.innerHTML = coins.map(coin => `
    <div class="price-card">
      <div class="price-header">
        <div>
          <div class="coin-name">${coin.name}</div>
          <div class="coin-symbol">${coin.symbol}</div>
        </div>
        <div>
          <span class="badge ${coin.price_change_percentage_24h >= 0 ? 'badge-success' : 'badge-error'}">
            ${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h.toFixed(2)}%
          </span>
        </div>
      </div>
      <div class="coin-price">$${coin.current_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
      <div style="font-size: 0.75rem; color: var(--text-tertiary);">
        MCap: $${(coin.market_cap / 1000000000).toFixed(2)}B
      </div>
    </div>
  `).join('');
}

function updateTicker(coins) {
  const ticker = document.getElementById('live-ticker');
  const tickerItems = coins.map(coin => `
    <div class="ticker-item">
      <span class="ticker-name">${coin.symbol.toUpperCase()}</span>
      <span class="ticker-price">$${coin.current_price.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
      <span class="badge ${coin.price_change_percentage_24h >= 0 ? 'badge-success' : 'badge-error'}">
        ${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h.toFixed(2)}%
      </span>
    </div>
  `).join('');

  ticker.innerHTML = tickerItems + tickerItems;
}

const searchInput = document.getElementById('crypto-search');
if (searchInput) {
  searchInput.addEventListener('input', debounce(function(e) {
    const query = e.target.value.toLowerCase();
    if (query) {
      const filtered = allCoins.filter(coin =>
        coin.name.toLowerCase().includes(query) ||
        coin.symbol.toLowerCase().includes(query)
      );
      displayPrices(filtered);
    } else {
      displayPrices(allCoins);
    }
  }, 300));
}

document.addEventListener('DOMContentLoaded', function() {
  fetchLivePrices();
  setInterval(fetchLivePrices, 60000);
});
</script>
{% endblock %}
